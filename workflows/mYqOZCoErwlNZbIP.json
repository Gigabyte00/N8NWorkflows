{
  "active": false,
  "connections": {
    "Prepare data": {
      "main": [
        [
          {
            "node": "Forecaster agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize Sales": {
      "main": [
        [
          {
            "node": "Prepare data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Forecaster agent": {
      "main": [
        [
          {
            "node": "Save Forecast to Supabase",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Forecast in Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Forecaster agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Run Daily Forecast": {
      "main": [
        [
          {
            "node": "Fetch Stripe Charges",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Stripe Charges": {
      "main": [
        [
          {
            "node": "Summarize Sales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store": {
      "ai_tool": [
        [
          {
            "node": "Forecaster agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Forecaster agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-07-19T10:51:48.554Z",
  "id": "mYqOZCoErwlNZbIP",
  "isArchived": false,
  "meta": {
    "templateId": "4577"
  },
  "name": "Automated Revenue Predictions from Stripe Data with GPT-4 and Google Sheets",
  "nodes": [
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"forecast\": {\n    \"June 2025\": \"$X,XXX.XX\",\n    \"July 2025\": \"$X,XXX.XX\",\n    \"August 2025\": \"$X,XXX.XX\"\n  },\n  \"trend\": \"Increasing / Decreasing / Stable\",\n  \"confidence\": \"High / Medium / Low\",\n  \"insights\": \"Short explanation of why this trend is predicted.\"\n}"
      },
      "id": "b946638e-ba68-4d73-816e-00f3a63d138f",
      "name": "Structured Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "position": [
        1840,
        2288
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "id": "d80c3670-e8c8-43ee-ba12-2e0e18b99862",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        1600,
        2288
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "Sales_data",
        "toolDescription": "The data about stripe sales",
        "pineconeIndex": {
          "__rl": true,
          "mode": "list",
          "value": "new",
          "cachedResultName": "new"
        },
        "options": {}
      },
      "id": "bb75cafb-9dad-4952-89af-0658c4d88aa4",
      "name": "Pinecone Vector Store",
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "position": [
        1616,
        2464
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "7d370700-89d9-4163-8070-4a0c643531ca",
      "name": "Embeddings OpenAI",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "position": [
        1552,
        2672
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 9
            }
          ]
        }
      },
      "id": "81de1ecf-75de-44fd-9e62-c381e907c1e1",
      "name": "Run Daily Forecast",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        416,
        2064
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "resource": "charge",
        "operation": "getAll",
        "returnAll": true
      },
      "id": "9ce2e0e4-8784-4ed9-9499-b5f54241d04e",
      "name": "Fetch Stripe Charges",
      "type": "n8n-nodes-base.stripe",
      "position": [
        640,
        2064
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "jsCode": "const charges = items.map(item => item.json);\nconst summary = charges.reduce((acc, charge) => {\n  const date = new Date(charge.created * 1000).toISOString().split(\"T\")[0];\n  acc[date] = (acc[date] || 0) + charge.amount / 100;\n  return acc;\n}, {});\nreturn [{ json: { summary } }];\n"
      },
      "id": "c115eb0c-6877-46db-bf03-55e48527dbc5",
      "name": "Summarize Sales",
      "type": "n8n-nodes-base.code",
      "position": [
        848,
        2064
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6aa7f5d2-3aa4-4d4c-85df-0d56bb7b6c9e",
              "name": "summary",
              "type": "string",
              "value": "={{ $json.summary }}"
            }
          ]
        },
        "options": {}
      },
      "id": "fb33581a-9f41-49d7-a722-a68dfe5bc265",
      "name": "Prepare data",
      "type": "n8n-nodes-base.set",
      "position": [
        1072,
        2064
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are a CFO AI Agent. Based on the following Stripe sales data:\n\n{{ $json.summary }}\n\nAnalyze the trends, identify any patterns (growth, decline, seasonality), and forecast expected daily or weekly revenue for the next 3 months.",
        "hasOutputParser": true,
        "options": {}
      },
      "id": "d3458681-2654-4e22-8b2d-1711b60ed592",
      "name": "Forecaster agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1648,
        2064
      ],
      "typeVersion": 1.9
    },
    {
      "parameters": {
        "dataToSend": "autoMapInputData"
      },
      "id": "325e4952-868c-460a-aa78-2e718477cc78",
      "name": "Save Forecast to Supabase",
      "type": "n8n-nodes-base.supabase",
      "position": [
        2512,
        1904
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "mode": "list",
          "value": "108tyyL--yUCbDk4drB__eztLSwjlxcmoRkqYsFnMLrY",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/108tyyL--yUCbDk4drB__eztLSwjlxcmoRkqYsFnMLrY/edit?usp=drivesdk",
          "cachedResultName": "CFO Forecasting"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": "gid=0",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/108tyyL--yUCbDk4drB__eztLSwjlxcmoRkqYsFnMLrY/edit#gid=0",
          "cachedResultName": "Sheet1"
        },
        "columns": {
          "value": {
            "trend": "={{ $json.output.trend }}",
            "forecast": "={{ $json.output.forecast }}",
            "insights": "={{ $json.output.insights }}",
            "confidence": "={{ $json.output.confidence }}"
          },
          "schema": [
            {
              "id": "forecast",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "forecast",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "trend",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "trend",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "confidence",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "confidence",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            },
            {
              "id": "insights",
              "type": "string",
              "display": true,
              "required": false,
              "displayName": "insights",
              "defaultMatch": false,
              "canBeUsedToMatch": true
            }
          ],
          "mappingMode": "defineBelow",
          "matchingColumns": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "9fd6efab-edc6-49be-9516-f2d36e1995b2",
      "name": "Log Forecast in Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        2512,
        2192
      ],
      "typeVersion": 4.5
    },
    {
      "parameters": {
        "content": "## 1ï¸âƒ£ **ğŸ” Data Retrieval & Preprocessing**\n\n**Nodes:**\n\n* ğŸ•’ `Run Daily Forecast`\n* ğŸŸ¦ `Fetch Stripe Charges`\n* ğŸ§© `Summarize Daily Sales`\n* âœï¸ `Prepare Forecast Prompt`\n\n---\n\n### ğŸ•’ `Run Daily Forecast`\n\n**Type:** Cron Trigger\n**Purpose:**\nAutomatically runs the workflow every day to keep forecasts updated with the latest sales data.\n\nğŸ”§ **Configuration:**\n\n* Schedule: Daily at 6 AM UTC (or as needed)\n\n---\n\n### ğŸŸ¦ `Fetch Stripe Charges`\n\n**Type:** Stripe Node\n**Purpose:**\nRetrieves all successful transactions from Stripe in a defined timeframe.\n\nğŸ“¥ **Details:**\n\n* Resource: `Charges`\n* Operation: `Get Many`\n* Filters:\n\n  * `created[gte]` (e.g. last 30 days)\n  * `status: succeeded`\n* Expansion (optional): `data.customer` for customer context\n\nâœ… **Output:** Raw Stripe sales data with timestamps and amounts\n\n---\n\n### ğŸ§© `Summarize Daily Sales`\n\n**Type:** Code Node\n**Purpose:**\nProcesses Stripe charges and summarizes revenue per day.\n\nğŸ§  **Logic:**\n\n* Converts Unix timestamps to `YYYY-MM-DD`\n* Aggregates total revenue per day\n* Converts cents to dollars\n\nğŸ“¦ **Output Sample:**\n\n```json\n{\n  \"2025-05-01\": 1245.50,\n  \"2025-05-02\": 980.00\n}\n```\n\n---\n\n### âœï¸ `Prepare Forecast Prompt`\n\n**Type:** Edit Fields / Function\n**Purpose:**\nFormats the summary into a natural language prompt for OpenAI.\n\nğŸ§  **Example Prompt:**\n\n```txt\nGiven the following sales data:\n{ \"2025-05-01\": 1245.50, ... }\n\nPredict trends and forecast sales for the next 3 months.\n```\n\nğŸ§¾ **Output:** `prompt` (String) â†’ sent to the AI Agent\n",
        "height": 2120,
        "width": 840,
        "color": 3
      },
      "id": "241e625d-7019-4919-9f93-137461ad94bf",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        368,
        240
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## 2ï¸âƒ£ **ğŸ¤– AI Agent Forecasting**\n\n**Nodes:**\n\n* ğŸ¤– `Forecast with OpenAI Agent`\n* ğŸ§  `OpenAI GPT-4 Model`\n* ğŸ“„ `Extract Forecast Output`\n* ğŸŒ² `Store Context in Pinecone` *(Optional)*\n* ğŸ§¬ `Generate Embeddings` *(Optional)*\n\n---\n\n### ğŸ¤– `Forecast with OpenAI Agent`\n\n**Type:** Tools Agent\n**Purpose:**\nActs as an intelligent agent that reads the sales summary and responds with forecasts and reasoning.\n\nğŸ§  **Prompt Input:**\nPassed from `Prepare Forecast Prompt`\n\nğŸ’¬ **Uses:**\n\n* Model: `GPT-4`\n* Output Parser: Structured JSON format\n\nğŸ“ˆ **Forecast Intent:**\nPredicts next 3 months, identifies trends, and gives a confidence level\n\n---\n\n### ğŸ§  `OpenAI GPT-4 Model`\n\n**Type:** OpenAI Node\n**Purpose:**\nHandles the natural language generation based on the supplied prompt.\n\nğŸ§¾ **Configuration:**\n\n* Model: `gpt-4` or `gpt-4-turbo`\n* Temperature: `0.2` (more deterministic)\n* Max Tokens: `1000`\n\n---\n\n### ğŸ“„ `Extract Forecast Output`\n\n**Type:** Structured Output Parser\n**Purpose:**\nParses the GPT response into usable JSON format.\n\nğŸ“¦ **Expected Output:**\n\n```json\n{\n  \"forecast\": {\n    \"June\": \"$15,000.00\",\n    \"July\": \"$16,500.00\",\n    \"August\": \"$17,200.00\"\n  },\n  \"trend\": \"Increasing\",\n  \"confidence\": \"High\",\n  \"insights\": \"Sales show strong momentum...\"\n}\n```\n\n---\n\n### ğŸŒ² `Store Context in Pinecone` *(optional)*\n\n**Type:** Vector Store\n**Purpose:**\nIndexes past data for retrieval-based prompting (RAG). Useful for long-term memory.\n\n---\n\n### ğŸ§¬ `Generate Embeddings` *(optional)*\n\n**Type:** Embeddings Node\n**Purpose:**\nConverts text into vector format before inserting into Pinecone.",
        "height": 2680,
        "width": 840,
        "color": 6
      },
      "id": "f60c6c15-8449-457a-aaad-2ebca8d75318",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1360,
        192
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## 3ï¸âƒ£ **ğŸ“¦ Storage & Reporting**\n\n**Nodes:**\n\n* ğŸŸ© `Save Forecast to Supabase`\n* ğŸ“Š `Log Forecast in Google Sheets`\n\n---\n\n### ğŸŸ© `Save Forecast to Supabase`\n\n**Type:** Supabase Node\n**Purpose:**\nStores all forecast results for analytics, versioning, or historical comparisons.\n\nğŸ›¢ï¸ **Table:** `forecasts`\nğŸ§¾ **Columns Example:**\n\n| timestamp  | raw\\_data | forecast\\_data |\n| ---------- | --------- | -------------- |\n| 2025-05-29 | {...}     | {...}          |\n\n---\n\n### ğŸ“Š `Log Forecast in Google Sheets`\n\n**Type:** Google Sheets Node\n**Purpose:**\nPushes structured data into a visual format for reporting dashboards or human review.\n\nğŸ“‹ **Column Format:**\n\n| Date       | Forecast (USD) | Trend      | Confidence | Insights                   |\n| ---------- | -------------- | ---------- | ---------- | -------------------------- |\n| 2025-05-29 | \\$15,000.00    | Increasing | High       | Sales rising at 10% weekly |\n\n---\n\n## âœ… Summary Flow\n\n```txt\nğŸ” Sales Data (Stripe) \n â†’ ğŸ§  Forecast Agent (OpenAI) \n â†’ ğŸ“¦ Stored in Supabase \n â†’ ğŸ“Š Reported in Google Sheets",
        "height": 1560,
        "width": 460,
        "color": 5
      },
      "id": "8e9b2ea7-58bb-4f62-a69c-eed70032019c",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2336,
        848
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "=======================================\n            WORKFLOW ASSISTANCE\n=======================================\nFor any questions or support, please contact:\n    Yaron@nofluff.online\n\nExplore more tips and tutorials here:\n   - YouTube: https://www.youtube.com/@YaronBeen/videos\n   - LinkedIn: https://www.linkedin.com/in/yaronbeen/\n=======================================\n",
        "height": 320,
        "width": 1300,
        "color": 4
      },
      "id": "7d1186c9-cba1-4876-a405-fa67773b8dad",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1440,
        272
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "# ğŸ“Š CFO Forecasting Agent â€“ Workflow Documentation\n\n---\n\n## 1ï¸âƒ£ **ğŸ” Data Retrieval & Preprocessing**\n\n**Nodes:**\n\n* ğŸ•’ `Run Daily Forecast`\n* ğŸŸ¦ `Fetch Stripe Charges`\n* ğŸ§© `Summarize Daily Sales`\n* âœï¸ `Prepare Forecast Prompt`\n\n---\n\n### ğŸ•’ `Run Daily Forecast`\n\n**Type:** Cron Trigger\n**Purpose:**\nAutomatically runs the workflow every day to keep forecasts updated with the latest sales data.\n\nğŸ”§ **Configuration:**\n\n* Schedule: Daily at 6 AM UTC (or as needed)\n\n---\n\n### ğŸŸ¦ `Fetch Stripe Charges`\n\n**Type:** Stripe Node\n**Purpose:**\nRetrieves all successful transactions from Stripe in a defined timeframe.\n\nğŸ“¥ **Details:**\n\n* Resource: `Charges`\n* Operation: `Get Many`\n* Filters:\n\n  * `created[gte]` (e.g. last 30 days)\n  * `status: succeeded`\n* Expansion (optional): `data.customer` for customer context\n\nâœ… **Output:** Raw Stripe sales data with timestamps and amounts\n\n---\n\n### ğŸ§© `Summarize Daily Sales`\n\n**Type:** Code Node\n**Purpose:**\nProcesses Stripe charges and summarizes revenue per day.\n\nğŸ§  **Logic:**\n\n* Converts Unix timestamps to `YYYY-MM-DD`\n* Aggregates total revenue per day\n* Converts cents to dollars\n\nğŸ“¦ **Output Sample:**\n\n```json\n{\n  \"2025-05-01\": 1245.50,\n  \"2025-05-02\": 980.00\n}\n```\n\n---\n\n### âœï¸ `Prepare Forecast Prompt`\n\n**Type:** Edit Fields / Function\n**Purpose:**\nFormats the summary into a natural language prompt for OpenAI.\n\nğŸ§  **Example Prompt:**\n\n```txt\nGiven the following sales data:\n{ \"2025-05-01\": 1245.50, ... }\n\nPredict trends and forecast sales for the next 3 months.\n```\n\nğŸ§¾ **Output:** `prompt` (String) â†’ sent to the AI Agent\n\n---\n\n## 2ï¸âƒ£ **ğŸ¤– AI Agent Forecasting**\n\n**Nodes:**\n\n* ğŸ¤– `Forecast with OpenAI Agent`\n* ğŸ§  `OpenAI GPT-4 Model`\n* ğŸ“„ `Extract Forecast Output`\n* ğŸŒ² `Store Context in Pinecone` *(Optional)*\n* ğŸ§¬ `Generate Embeddings` *(Optional)*\n\n---\n\n### ğŸ¤– `Forecast with OpenAI Agent`\n\n**Type:** Tools Agent\n**Purpose:**\nActs as an intelligent agent that reads the sales summary and responds with forecasts and reasoning.\n\nğŸ§  **Prompt Input:**\nPassed from `Prepare Forecast Prompt`\n\nğŸ’¬ **Uses:**\n\n* Model: `GPT-4`\n* Output Parser: Structured JSON format\n\nğŸ“ˆ **Forecast Intent:**\nPredicts next 3 months, identifies trends, and gives a confidence level\n\n---\n\n### ğŸ§  `OpenAI GPT-4 Model`\n\n**Type:** OpenAI Node\n**Purpose:**\nHandles the natural language generation based on the supplied prompt.\n\nğŸ§¾ **Configuration:**\n\n* Model: `gpt-4` or `gpt-4-turbo`\n* Temperature: `0.2` (more deterministic)\n* Max Tokens: `1000`\n\n---\n\n### ğŸ“„ `Extract Forecast Output`\n\n**Type:** Structured Output Parser\n**Purpose:**\nParses the GPT response into usable JSON format.\n\nğŸ“¦ **Expected Output:**\n\n```json\n{\n  \"forecast\": {\n    \"June\": \"$15,000.00\",\n    \"July\": \"$16,500.00\",\n    \"August\": \"$17,200.00\"\n  },\n  \"trend\": \"Increasing\",\n  \"confidence\": \"High\",\n  \"insights\": \"Sales show strong momentum...\"\n}\n```\n\n---\n\n### ğŸŒ² `Store Context in Pinecone` *(optional)*\n\n**Type:** Vector Store\n**Purpose:**\nIndexes past data for retrieval-based prompting (RAG). Useful for long-term memory.\n\n---\n\n### ğŸ§¬ `Generate Embeddings` *(optional)*\n\n**Type:** Embeddings Node\n**Purpose:**\nConverts text into vector format before inserting into Pinecone.\n\n---\n\n## 3ï¸âƒ£ **ğŸ“¦ Storage & Reporting**\n\n**Nodes:**\n\n* ğŸŸ© `Save Forecast to Supabase`\n* ğŸ“Š `Log Forecast in Google Sheets`\n\n---\n\n### ğŸŸ© `Save Forecast to Supabase`\n\n**Type:** Supabase Node\n**Purpose:**\nStores all forecast results for analytics, versioning, or historical comparisons.\n\nğŸ›¢ï¸ **Table:** `forecasts`\nğŸ§¾ **Columns Example:**\n\n| timestamp  | raw\\_data | forecast\\_data |\n| ---------- | --------- | -------------- |\n| 2025-05-29 | {...}     | {...}          |\n\n---\n\n### ğŸ“Š `Log Forecast in Google Sheets`\n\n**Type:** Google Sheets Node\n**Purpose:**\nPushes structured data into a visual format for reporting dashboards or human review.\n\nğŸ“‹ **Column Format:**\n\n| Date       | Forecast (USD) | Trend      | Confidence | Insights                   |\n| ---------- | -------------- | ---------- | ---------- | -------------------------- |\n| 2025-05-29 | \\$15,000.00    | Increasing | High       | Sales rising at 10% weekly |\n\n---\n\n## âœ… Summary Flow\n\n```txt\nğŸ” Sales Data (Stripe) \n â†’ ğŸ§  Forecast Agent (OpenAI) \n â†’ ğŸ“¦ Stored in Supabase \n â†’ ğŸ“Š Reported in Google Sheets\n```\n",
        "height": 4778,
        "width": 1289,
        "color": 4
      },
      "id": "2b9e9108-8084-4e3f-a620-5bee07040bc3",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1440,
        608
      ],
      "typeVersion": 1
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-07-19T10:51:48.554Z",
  "versionId": "c5815ae1-0ed5-406d-8363-c379c6b4de79"
}